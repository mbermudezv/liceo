<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="SiMarca">
    <meta name="theme-color" content="#499bea" />
    <link rel="manifest" href="../manifest.json">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/css_marcaCodigoBarra.css">    
    <title>SiMarca</title>  
</head>

<body>

    <div id="encabezadoBar" class="d-flex flex-row 
                                    justify-content-between bg-info">

        <a href="marcaTipoSeleccionar.html" class="m-1">
            <img src="../img/salir.png">
        </a>

        <a href="#" class="m-1">
            <img src="../img/buscar.png">
        </a>
                                                                    
    </div>

    <div id="mainArea" class="container-fluid">               

        <div id="tipoMarca_Descripcion" class="m-1 p-1"></div>

        <div id="divNombre" class="m-1 p-1"></div>

        <div id="containerTxt">

            <input type="text" id="txtMarca" maxlength="20">

        </div>

    </div>

    <div id="statusBar" class="d-flex flex-row justify-content-between bg-info" >

        <a id="linkHogar" href="https://www.lasesperanzas.ed.cr">lasesperanzas.ed.cr</a>
        <a id="linkWappcom"href="https://www.wappcom.net">wappcom.net</a>

    </div>
    
    <script src="../js/marcaCodigoBarra.js"></script>

    <script>
    
        // document.getElementById("txtMarca").onkeydown = 
        // function(evt) {
            
        //     let charCode = typeof evt.which == "number" ? evt.which : evt.keyCode;

        //     if (charCode == 13) {

        //         let strCedula = document.getElementById("txtMarca").value;

        //         selectEstudianteGestor(strCedula);

        //     }
            
        //     evt.preventDefault();

        // };

        function transformTypedChar(charStr) {

            return charStr == "'" ? "-" : charStr;

        }   

        document.getElementById("txtMarca").onkeypress = 
        function(evt) {
            
            let val = this.value;

            evt = evt || window.event;

            // Ensure we only handle printable keys, excluding enter and space
            let charCode = typeof evt.which == "number" ? evt.which : evt.keyCode;

            if (charCode && charCode > 32) {
                
                let keyChar = String.fromCharCode(charCode);
                
                //remplazaCaracter(keyChar, this, val);

                // Transform typed character
                let mappedChar = transformTypedChar(keyChar);
                
                let start, end;
                
                if (typeof this.selectionStart == "number" && typeof this.selectionEnd == "number") {
                    // Non-IE browsers and IE 9
                    start = this.selectionStart;
                    end = this.selectionEnd;
                    this.value = val.slice(0, start) + mappedChar + val.slice(end);
                
                    // Move the caret
                    this.selectionStart = this.selectionEnd = start + 1;
                
                } else if (document.selection && document.selection.createRange) {
                    
                    // For IE up to version 8
                    let selectionRange = document.selection.createRange();
                    let textInputRange = this.createTextRange();
                    let precedingRange = this.createTextRange();
                    let bookmark = selectionRange.getBookmark();
                    textInputRange.moveToBookmark(bookmark);
                    precedingRange.setEndPoint("EndToStart", textInputRange);
                    start = precedingRange.text.length;
                    end = start + selectionRange.text.length;
                
                    this.value = val.slice(0, start) + mappedChar + val.slice(end);
                    start++;
                
                    // Move the caret
                    textInputRange = this.createTextRange();
                    textInputRange.collapse(true);
                    textInputRange.move("character", start - (this.value.slice(0, start).split("\r\n").length - 1));
                    textInputRange.select();

            }
        };

    }

        if ('serviceWorker' in navigator) {
            
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('../service-worker.js')
                    .then((reg) => {
                    console.log('Registrando el Service worker.', reg);
                    }, function(err) {
                            // registration failed :(
                            console.log('Error al registrar el ServiceWorker: ', err);
                        });
            });

        }

    </script> 

</body>

</html>